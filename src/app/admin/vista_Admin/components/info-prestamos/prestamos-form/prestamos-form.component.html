<form
  [formGroup]="form"
  (ngSubmit)="onSubmit()"
  class="bg-white dark:bg-gray-900 border border-green-300 shadow-lg rounded-xl p-6 space-y-5"
>
  <!-- Selección del socio -->
  <div>
    <label
      class="block text-sm font-medium text-green-800 dark:text-green-100 mb-1"
      >Seleccione un socio</label
    >
    <select
      formControlName="socio_id"
      class="w-full border border-green-300 rounded-md px-3 py-2 bg-white dark:bg-gray-800 text-gray-800 dark:text-gray-100 focus:outline-none focus:ring-2 focus:ring-green-400"
    >
      <option value="" disabled>Seleccione un socio</option>
      <option *ngFor="let socio of socios" [value]="socio.id">
        {{ socio.usuario?.nombre }}
        {{ socio.usuario?.apellido }} - {{ socio.usuario?.dni }}
      </option>
    </select>
    <div
      *ngIf="form.get('socio_id')?.invalid && form.get('socio_id')?.touched"
      class="text-red-500 text-sm mt-1"
    >
      Seleccionar un socio es obligatorio.
    </div>
  </div>

  <!-- Producto -->
  <div>
    <label
      class="block text-sm font-medium text-green-800 dark:text-green-100 mb-1"
      >Producto</label
    >

    <select
      formControlName="producto"
      class="w-full border border-green-300 rounded-md px-3 py-2 bg-white dark:bg-gray-800 text-gray-800 dark:text-gray-100 focus:outline-none focus:ring-2 focus:ring-green-400"
    >
      <option value="" disabled selected>Seleccione un producto</option>
      <option *ngFor="let prod of productos" [value]="prod">
        {{ prod }}
      </option>
    </select>

    <div
      *ngIf="form.get('producto')?.invalid && form.get('producto')?.touched"
      class="text-red-500 text-sm mt-1"
    >
      El producto es obligatorio.
    </div>
  </div>

  <!-- Tipo de Seguro -->
  <div>
    <label
      class="block text-sm font-medium text-green-800 dark:text-green-100 mb-1"
      >Tipo de Seguro</label
    >
    <input
      formControlName="tipo_seguro"
      placeholder="Ej: Convencional Individual"
      class="w-full border border-green-300 rounded-md px-3 py-2 bg-white dark:bg-gray-800 text-gray-800 dark:text-gray-100 focus:outline-none focus:ring-2 focus:ring-green-400"
    />
    <div
      *ngIf="
        form.get('tipo_seguro')?.invalid && form.get('tipo_seguro')?.touched
      "
      class="text-red-500 text-sm mt-1"
    >
      El tipo de seguro es obligatorio.
    </div>
  </div>

  <!-- Monto -->
  <div>
    <label
      class="block text-sm font-medium text-green-800 dark:text-green-100 mb-1"
      >Monto</label
    >
    <input
      formControlName="monto"
      type="number"
      placeholder="Monto"
      class="w-full border border-green-300 rounded-md px-3 py-2 bg-white dark:bg-gray-800 text-gray-800 dark:text-gray-100 focus:outline-none focus:ring-2 focus:ring-green-400"
    />
    <div
      *ngIf="form.get('monto')?.invalid && form.get('monto')?.touched"
      class="text-red-500 text-sm mt-1"
    >
      <div *ngIf="form.get('monto')?.errors?.['required']">
        El monto es obligatorio.
      </div>
      <div *ngIf="form.get('monto')?.errors?.['min']">
        Debe ser mayor o igual a 400.
      </div>
      <div *ngIf="form.get('monto')?.errors?.['max']">
        Debe ser menor o igual a 8000.
      </div>
    </div>
  </div>

  <!-- Cuotas Totales -->
  <div>
    <label
      class="block text-sm font-medium text-green-800 dark:text-green-100 mb-1"
      >Cuotas Totales</label
    >
    <input
      formControlName="cuotas_totales"
      type="number"
      placeholder="Cuotas Totales"
      class="w-full border border-green-300 rounded-md px-3 py-2 bg-white dark:bg-gray-800 text-gray-800 dark:text-gray-100 focus:outline-none focus:ring-2 focus:ring-green-400"
    />
    <div
      *ngIf="
        form.get('cuotas_totales')?.invalid &&
        form.get('cuotas_totales')?.touched
      "
      class="text-red-500 text-sm mt-1"
    >
      <div *ngIf="form.get('cuotas_totales')?.errors?.['required']">
        Las cuotas son obligatorias.
      </div>
      <div *ngIf="form.get('cuotas_totales')?.errors?.['min']">
        Debe ser al menos 6 cuotas.
      </div>
      <div *ngIf="form.get('cuotas_totales')?.errors?.['max']">
        No debe exceder 36 cuotas.
      </div>
    </div>
  </div>

  <!-- Interés Anual -->
  <div>
    <label
      class="block text-sm font-medium text-green-800 dark:text-green-100 mb-1"
      >Interés Anual (%)</label
    >
    <input
      formControlName="interes_anual"
      type="number"
      step="0.01"
      placeholder="Interés Anual (%)"
      class="w-full border border-green-300 rounded-md px-3 py-2 bg-white dark:bg-gray-800 text-gray-800 dark:text-gray-100 focus:outline-none focus:ring-2 focus:ring-green-400"
    />
    <div
      *ngIf="
        form.get('interes_anual')?.invalid && form.get('interes_anual')?.touched
      "
      class="text-red-500 text-sm mt-1"
    >
      <div *ngIf="form.get('interes_anual')?.errors?.['required']">
        El interés es obligatorio.
      </div>
      <div *ngIf="form.get('interes_anual')?.errors?.['min']">
        Debe ser mayor o igual a 4%.
      </div>
    </div>
  </div>

  <!-- Tasa de Seguro -->
  <div>
    <label
      class="block text-sm font-medium text-green-800 dark:text-green-100 mb-1"
      >Tasa de Seguro de Desgravamen (%)</label
    >
    <input
      formControlName="tasa_seguro"
      type="number"
      step="0.001"
      placeholder="Tasa Seguro"
      class="w-full border border-green-300 rounded-md px-3 py-2 bg-white dark:bg-gray-800 text-gray-800 dark:text-gray-100 focus:outline-none focus:ring-2 focus:ring-green-400"
    />
    <div
      *ngIf="
        form.get('tasa_seguro')?.invalid && form.get('tasa_seguro')?.touched
      "
      class="text-red-500 text-sm mt-1"
    >
      La tasa de seguro es obligatoria.
    </div>
  </div>

  <!-- Fecha Inicio -->
  <div>
    <label
      class="block text-sm font-medium text-green-800 dark:text-green-100 mb-1"
      >Fecha de Inicio</label
    >
    <input
      formControlName="fecha_inicio"
      type="date"
      class="w-full border border-green-300 rounded-md px-3 py-2 bg-white dark:bg-gray-800 text-gray-800 dark:text-gray-100 focus:outline-none focus:ring-2 focus:ring-green-400"
    />
    <div
      *ngIf="
        form.get('fecha_inicio')?.invalid && form.get('fecha_inicio')?.touched
      "
      class="text-red-500 text-sm mt-1"
    >
      <div *ngIf="form.get('fecha_inicio')?.errors?.['required']">
        La fecha de inicio es obligatoria.
      </div>
      <div *ngIf="form.get('fecha_inicio')?.errors?.['fechaPasada']">
        La fecha no puede ser en el pasado.
      </div>
    </div>
  </div>

  <!-- Botones -->
  <div class="flex gap-4 mt-4">
    <button
      type="submit"
      [disabled]="form.invalid"
      class="bg-green-600 hover:bg-green-700 text-white font-semibold px-4 py-2 rounded-md shadow"
    >
      {{ prestamo ? "Actualizar" : "Crear" }}
    </button>
    <button
      type="button"
      (click)="onCancel()"
      class="bg-red-500 hover:bg-red-600 text-white font-semibold px-4 py-2 rounded-md shadow"
    >
      Cancelar
    </button>
  </div>
</form>

<!-- Mostrar TCEA -->
<div
  *ngIf="tceaReferencial !== null"
  class="mt-4 text-green-700 dark:text-green-600"
>
  <strong>TCEA Referencial:</strong> {{ tceaReferencial }}%
</div>
